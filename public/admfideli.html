<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Painel Administrativo - Gestão de Viagens</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <div class="container mt-5">
    <h1 class="text-center">Painel Administrativo - Gestão de Viagens</h1>

    <h3 class="mt-4">Clientes Cadastrados</h3>
    <table class="table table-bordered" id="clientes-table">
      <thead>
        <tr>
          <th>Nome</th>
          <th>CPF</th>
          <th>RG</th>
          <th>Idade</th>
          <th>Viagens</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody id="clientes-list"></tbody>
    </table>

    <h3>Editar Dados do Cliente</h3>
    <form id="form-editar-cliente">
      <input type="hidden" id="cliente-id">
      <!-- Outras informações do cliente aqui -->
      <div class="mb-3">
        <label for="viagens" class="form-label">Número de Viagens</label>
        <input type="number" class="form-control" id="viagens" required>
      </div>
      <button type="submit" class="btn btn-primary">Salvar Alterações</button>
    </form>

    <h3>Simular Login de Cliente</h3>
    <button class="btn btn-info" onclick="simularLogin(1)">Login Cliente 1</button>
    <button class="btn btn-info" onclick="simularLogin(2)">Login Cliente 2</button>
  </div>

  <script>
    // Função para carregar a lista de clientes
    function carregarClientes() {
      const clientes = JSON.parse(localStorage.getItem('clientes')) || [];
      const tableBody = document.getElementById('clientes-list');
      tableBody.innerHTML = '';  // Limpa a tabela

      clientes.forEach(cliente => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${cliente.nome}</td>
          <td>${cliente.cpf}</td>
          <td>${cliente.rg}</td>
          <td>${cliente.idade}</td>
          <td>${cliente.viagens}</td> <!-- Exibe o número de viagens -->
          <td>
            <button class="btn btn-warning" onclick="editarCliente(${cliente.id})">Editar</button>
            <button class="btn btn-danger" onclick="excluirCliente(${cliente.id})">Excluir</button>
            <button class="btn btn-success" onclick="atualizarViagens(${cliente.id})">Atualizar Viagens</button>
          </td>
        `;
        tableBody.appendChild(row);
      });
    }

    // Função para editar um cliente
    function editarCliente(id) {
      const clientes = JSON.parse(localStorage.getItem('clientes')) || [];
      const cliente = clientes.find(c => c.id === id);

      if (cliente) {
        document.getElementById('cliente-id').value = cliente.id;
        document.getElementById('viagens').value = cliente.viagens; // Preenche o número de viagens
      }
    }

    // Função para atualizar o número de viagens de um cliente
    function atualizarViagens(id) {
      const viagens = parseInt(document.getElementById('viagens').value);

      if (isNaN(viagens)) {
        alert('Por favor, insira um número válido de viagens.');
        return;
      }

      let clientes = JSON.parse(localStorage.getItem('clientes')) || [];
      const cliente = clientes.find(c => c.id === id);

      if (cliente) {
        cliente.viagens = viagens; // Atualiza o número de viagens do cliente
        localStorage.setItem('clientes', JSON.stringify(clientes)); // Atualiza no LocalStorage

        // Atualiza a página do cliente com as bolinhas
        fetch(`http://localhost:3000/updateViagens/${id}`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ viagens: cliente.viagens })
        })
        .then(response => response.json())
        .then(data => {
          console.log('Viagens atualizadas no servidor:', data);
        })
        .catch(error => {
          console.error('Erro ao atualizar viagens no servidor:', error);
        });

        carregarClientes(); // Atualiza a tabela de clientes
      }
    }

    // Função para excluir um cliente
    function excluirCliente(id) {
      let clientes = JSON.parse(localStorage.getItem('clientes')) || [];
      clientes = clientes.filter(cliente => cliente.id !== id);
      localStorage.setItem('clientes', JSON.stringify(clientes));

      // Se houver necessidade de atualizar no servidor
      fetch(`http://localhost:3000/deleteUser/${id}`, {
        method: 'DELETE',
      })
      .then(response => response.json())
      .then(data => {
        console.log('Cliente excluído no servidor:', data);
      })
      .catch(error => {
        console.error('Erro ao excluir cliente no servidor:', error);
      });

      carregarClientes(); // Recarrega a lista de clientes
    }

    // Função para simular o login de um cliente
    function simularLogin(clienteId) {
      localStorage.setItem('currentUser', clienteId);
      alert('Cliente logado com ID: ' + clienteId);
    }

    // Inicializa a página
    carregarClientes();
  </script>
</body>
</html>
